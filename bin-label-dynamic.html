<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Stargate Hydrogen dynamic warehouse bin label</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    @media print {
      @page { margin: 0; }
      input {
        border: none;
      }
    }

    body {
      font-family: Arial, sans-serif;
      font-size: 12px;
      margin: 0;
      border: 1px dashed #000;
      box-sizing: border-box;
    }

    .grid-container {
      width: 100%;
      height: 100%;
      display: grid;
      box-sizing: border-box;
      border: 1px solid #000;
    }

    .grid-container.borders {
      border: 1px solid #000;
    }

    .grid-container:not(.borders) {
      border: none;
    }

    .borders .grid-item {
      border: 1px solid #000;
    }

    .grid-container:not(.borders) .grid-item {
      border: none;
    }

    .grid-item {
      border: 1px solid #000;
      padding: 5px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      gap: 5px;
      align-items: center;
      justify-content: center;
    }

    .qr {
      width: 60%;
      height: 60%;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #999;
    }

    .qr img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .qr canvas {
      display: none;
    }

    .code {
      font-weight: bold;
    }

    .controls {
      position: fixed;
      top: 10px;
      right: 10px;
      background: white;
      padding: 10px;
      border: 1px solid #ccc;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    @media print {
      .controls {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="controls">
    <div>
      <label for="binInput">Bin Code:</label>
      <input type="text" id="binInput" value="ST-E">
    </div>
    <div>
      <label for="rowsInput">Rows:</label>
      <input type="number" id="rowsInput" value="3" min="1" max="10">
    </div>
    <div>
      <label for="colsInput">Columns:</label>
      <input type="number" id="colsInput" value="3" min="1" max="10">
    </div>
    <div>
      <label for="widthInput">Page Width (mm):</label>
      <input type="number" id="widthInput" value="210" min="1">
    </div>
    <div>
      <label for="heightInput">Page Height (mm):</label>
      <input type="number" id="heightInput" value="297" min="1">
    </div>
    <div>
      <label for="paddingInput">Page Padding (mm):</label>
      <input type="number" id="paddingInput" value="5" min="0">
    </div>
    <div>
      <label for="showBorders">Show Borders:</label>
      <input type="checkbox" id="showBorders" checked>
    </div>
    <div>
      <label for="qrSizeInput">QR Size (%):</label>
      <input type="number" id="qrSizeInput" value="60" min="10" max="100">
    </div>
    <div>
      <label for="fontSizeInput">Code Font Size (mm):</label>
      <input type="number" id="fontSizeInput" value="12" min="1" max="50" step="0.5">
    </div>
  </div>
  <div class="grid-container">
    <!-- Grid cells will be generated by JavaScript -->
  </div>

  <script>
    function generatePositions(rows, cols) {
      const positions = [];
      // Special case for 1x1 grid
      if (rows === 1 && cols === 1) {
        return [['']];  // Return empty string instead of row/column numbers
      }
      
      // Special case when either rows or cols is 1
      if (rows === 1) {
        return [[...Array(cols)].map((_, i) => `${i + 1}`)];
      }
      if (cols === 1) {
        return [...Array(rows)].map((_, i) => [`${rows - i}`]);
      }
      
      // Regular case for multiple rows/columns
      for (let row = rows; row >= 1; row--) {
        const rowPositions = [];
        for (let col = 1; col <= cols; col++) {
          rowPositions.push(`${row}${col}`);
        }
        positions.push(rowPositions);
      }
      return positions;
    }

    function updateGrid() {
      const rows = parseInt(document.getElementById('rowsInput').value) || 3;
      const cols = parseInt(document.getElementById('colsInput').value) || 3;
      
      // Update grid template
      const gridContainer = document.querySelector('.grid-container');
      gridContainer.style.gridTemplateColumns = `repeat(${cols}, minmax(0, 1fr))`;
      gridContainer.style.gridTemplateRows = `repeat(${rows}, minmax(0, 1fr))`;
      
      // Clear existing grid
      gridContainer.innerHTML = '';
      
      // Generate new positions
      const positions = generatePositions(rows, cols);
      
      // Create grid cells
      positions.forEach(row => {
        row.forEach(pos => {
          const cell = document.createElement('div');
          cell.className = 'grid-item';
          cell.innerHTML = `
            <div id="qr-${pos}" class="qr"></div>
            <span id="text-${pos}" class="code"></span>
          `;
          gridContainer.appendChild(cell);
        });
      });
      
      // Update QR codes and text
      encodeData(positions.flat());
    }

    function encodeData(positions = []) {
      const binInput = document.getElementById("binInput");
      const baseText = binInput.value || '';
      const qrSize = parseInt(document.getElementById("qrSizeInput").value) || 60;
      const fontSize = parseFloat(document.getElementById("fontSizeInput").value) || 7;

      positions.forEach(pos => {
        const cellText = `${baseText}${pos}`;
        const textElement = document.getElementById(`text-${pos}`);
        const qrElement = document.getElementById(`qr-${pos}`);
        
        if (textElement && qrElement) {
          textElement.textContent = cellText;
          textElement.style.fontSize = `${fontSize}mm`;
          
          // Clear and create new QR code
          qrElement.innerHTML = '';
          qrElement.style.width = `${qrSize}%`;
          qrElement.style.height = `${qrSize}%`;
          new QRCode(qrElement, {
            text: `%B%${cellText}`,
            width: 128,
            height: 128
          });
        }
      });
    }

    function updatePageDimensions() {
      const width = document.getElementById('widthInput').value;
      const height = document.getElementById('heightInput').value;
      const padding = document.getElementById('paddingInput').value;
      
      document.body.style.width = `${width}mm`;
      document.body.style.height = `${height}mm`;
      document.body.style.padding = `${padding}mm`;
    }

    document.addEventListener("DOMContentLoaded", () => {
      const binInput = document.getElementById("binInput");
      const rowsInput = document.getElementById("rowsInput");
      const colsInput = document.getElementById("colsInput");
      const widthInput = document.getElementById("widthInput");
      const heightInput = document.getElementById("heightInput");
      const paddingInput = document.getElementById("paddingInput");
      const showBorders = document.getElementById("showBorders");
      const qrSizeInput = document.getElementById("qrSizeInput");
      const fontSizeInput = document.getElementById("fontSizeInput");
      
      binInput.addEventListener("input", () => updateGrid());
      rowsInput.addEventListener("input", () => updateGrid());
      colsInput.addEventListener("input", () => updateGrid());
      widthInput.addEventListener("input", () => updatePageDimensions());
      heightInput.addEventListener("input", () => updatePageDimensions());
      paddingInput.addEventListener("input", () => updatePageDimensions());
      showBorders.addEventListener("change", () => {
        const gridContainer = document.querySelector('.grid-container');
        if (showBorders.checked) {
          gridContainer.classList.add('borders');
        } else {
          gridContainer.classList.remove('borders');
        }
      });
      qrSizeInput.addEventListener("input", () => updateGrid());
      fontSizeInput.addEventListener("input", () => updateGrid());

      // Initial setup
      document.querySelector('.grid-container').classList.add('borders');
      updatePageDimensions();
      updateGrid();
    });
  </script>
</body>
</html>